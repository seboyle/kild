# Investigation: Remove Dead Code Warnings in Cleanup Module

**Issue**: Free-form description
**Type**: CHORE
**Investigated**: 2026-01-20T15:12:41+02:00

### Assessment

| Metric | Value | Reasoning |
|--------|-------|-----------|
| Priority | LOW | Development noise issue that doesn't affect functionality but creates distraction during builds |
| Complexity | LOW | Simple removal of unused functions with existing tests - isolated change with no integration points |
| Confidence | HIGH | Clear evidence that functions are unused, well-defined scope, and straightforward solution |

---

## Problem Statement

Cargo compilation warnings appear every time `cargo run` is executed, showing three unused functions in `src/cleanup/operations.rs` that create development noise without providing value.

---

## Analysis

### Root Cause / Change Rationale

The cleanup module was recently enhanced with additional session detection strategies, but these functions were never integrated into the actual cleanup workflow. They exist as dead code that was likely planned for future use but never implemented.

### Evidence Chain

WHY: Cargo shows dead code warnings during compilation
↓ BECAUSE: Three functions are marked `pub` but never called
  Evidence: `src/cleanup/operations.rs:167` - `pub fn detect_sessions_without_pid`
  Evidence: `src/cleanup/operations.rs:201` - `pub fn detect_sessions_with_stopped_processes`  
  Evidence: `src/cleanup/operations.rs:245` - `pub fn detect_old_sessions`

↓ BECAUSE: Functions are not exported in mod.rs and not used in handler.rs
  Evidence: `src/cleanup/mod.rs:8-10` - Only exports `cleanup_all`, `cleanup_orphaned_resources`, `scan_for_orphans`
  Evidence: `src/cleanup/handler.rs` - Only calls `detect_orphaned_branches`, `detect_orphaned_worktrees`, `detect_stale_sessions`

↓ ROOT CAUSE: Dead code that should be removed to eliminate build warnings
  Evidence: `grep` search shows functions only exist in operations.rs with tests

### Affected Files

| File | Lines | Action | Description |
|------|-------|--------|-------------|
| `src/cleanup/operations.rs` | 167-199 | DELETE | Remove `detect_sessions_without_pid` function |
| `src/cleanup/operations.rs` | 201-243 | DELETE | Remove `detect_sessions_with_stopped_processes` function |
| `src/cleanup/operations.rs` | 245-285 | DELETE | Remove `detect_old_sessions` function |
| `src/cleanup/operations.rs` | 478-520 | DELETE | Remove associated test functions |

### Integration Points

- No integration points - functions are completely unused
- Tests exist but only test the unused functions themselves
- No external dependencies on these functions

### Git History

- **Introduced**: 15841ab - 2026-01-19 - "feat: add cleanup strategies for stale sessions (#15) (#23)"
- **Last modified**: 15841ab - 2026-01-19
- **Implication**: Recently added but never integrated into the cleanup workflow

---

## Implementation Plan

### Step 1: Remove detect_sessions_without_pid function

**File**: `src/cleanup/operations.rs`
**Lines**: 167-199
**Action**: DELETE

**Current code:**
```rust
// Lines 167-199
pub fn detect_sessions_without_pid(sessions_dir: &Path) -> Result<Vec<String>, CleanupError> {
    let mut sessions_without_pid = Vec::new();
    // ... full function implementation
}
```

**Required change:**
```rust
// Delete entire function
```

**Why**: Function is unused and creates compilation warnings

---

### Step 2: Remove detect_sessions_with_stopped_processes function

**File**: `src/cleanup/operations.rs`
**Lines**: 201-243
**Action**: DELETE

**Current code:**
```rust
// Lines 201-243
pub fn detect_sessions_with_stopped_processes(
    sessions_dir: &Path,
) -> Result<Vec<String>, CleanupError> {
    // ... full function implementation
}
```

**Required change:**
```rust
// Delete entire function
```

**Why**: Function is unused and creates compilation warnings

---

### Step 3: Remove detect_old_sessions function

**File**: `src/cleanup/operations.rs`
**Lines**: 245-285
**Action**: DELETE

**Current code:**
```rust
// Lines 245-285
pub fn detect_old_sessions(sessions_dir: &Path, days: u64) -> Result<Vec<String>, CleanupError> {
    // ... full function implementation
}
```

**Required change:**
```rust
// Delete entire function
```

**Why**: Function is unused and creates compilation warnings

---

### Step 4: Remove associated test functions

**File**: `src/cleanup/operations.rs`
**Lines**: 478-520 (approximate)
**Action**: DELETE

**Test cases to remove:**
```rust
#[test]
fn test_detect_sessions_without_pid() {
    // Remove this test since function is being deleted
}
```

---

## Patterns to Follow

**From codebase - mirror these exactly:**

```rust
// SOURCE: src/cleanup/handler.rs:21-40
// Pattern for actual cleanup function usage
match operations::detect_orphaned_branches(&repo) {
    Ok(orphaned_branches) => {
        // Handle success
    }
    Err(e) => {
        // Handle error
    }
}
```

---

## Edge Cases & Risks

| Risk/Edge Case | Mitigation |
|----------------|------------|
| Functions might be needed in future | If needed later, can be re-implemented based on git history |
| Tests might be testing important logic | Tests only test the unused functions themselves - no business logic loss |

---

## Validation

### Automated Checks

```bash
cargo check
cargo test
cargo clippy
```

### Manual Verification

1. Run `cargo run -- create test-shard --agent kiro` to verify no warnings appear
2. Run `cargo test cleanup` to verify remaining cleanup tests still pass

---

## Scope Boundaries

**IN SCOPE:**
- Remove unused functions and their tests
- Eliminate compilation warnings

**OUT OF SCOPE (do not touch):**
- Active cleanup functions (detect_orphaned_branches, detect_orphaned_worktrees, detect_stale_sessions)
- Cleanup handler logic
- Module exports in mod.rs

---

## Metadata

- **Investigated by**: Claude
- **Timestamp**: 2026-01-20T15:12:41+02:00
- **Artifact**: `.archon/artifacts/issues/investigation-2026-01-20T15-12-41.md`
